<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- global styles you provided -->
  <link rel="stylesheet" href="style.css">
  <style>
    /* page-specific calendar styles (kept small so global style.css remains authoritative) */
    .calendar-container { max-width:1100px; width:100%; margin: 1.2rem auto; }
    .calendar-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px; }
    .calendar-header h2 { font-size:1.3rem; }
    .weekday-row, .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .weekday {
      font-weight:600;
      font-size:0.85rem;
      color: #cbd5e1;
      text-align:center;
      padding:6px 4px;
    }
    .day, .empty {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.04);
      min-height: 92px;
      border-radius:10px;
      padding:8px;
      position:relative;
      overflow:hidden;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .day:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
    .day.has-event { background: rgba(255,255,255,0.03); border-color: rgba(99,102,241,0.16); }
    .day-number { font-weight:700; margin-bottom:6px; font-size:0.95rem; }
    .day ul { list-style:none; padding-left:0; margin-top:6px; font-size:0.78rem; text-align:left; }
    .day ul li { margin:4px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .event-badge { display:inline-block; padding:2px 6px; border-radius:6px; background: rgba(79,70,229,0.12); color:#dbeafe; font-size:0.75rem; }
    /* small responsive tweak */
    @media (max-width:720px) {
      .day, .empty { min-height:72px; padding:6px; font-size:0.82rem; }
      .calendar-container { padding: 0 12px; }
    }
    /* starfield sits behind everything (style.css already has #starfield rules) */
  </style>
</head>
<body>
  <!-- starfield element expected by style.css -->
  <div id="starfield" aria-hidden="true"></div>

  <!-- icon strip (visible even when sidebar closed) -->
  <div class="icon-strip" aria-hidden="true">
    <a href="index.html" title="Home">🏠</a>
    <a href="factfiles.html" title="Fact Files">📖</a>
    <a href="livesky.html" title="Live Sky">🔭</a>
    <a href="events.html" title="Events">📅</a>
    <a href="space-news.html" title="Space News">🛰️</a>
    <a href="about.html" title="About">ℹ️</a>
  </div>

  <!-- toggle button (positions defined in style.css) -->
  <button class="toggle-btn" id="toggleBtn" aria-label="Toggle sidebar">☰</button>

  <!-- sidebar (uses your style.css classes) -->
  <aside class="sidebar" id="sidebar">
    <ul>
      <li><a href="index.html"><span class="icon">🏠</span><span class="label">Home</span></a></li>
      <li><a href="factfiles.html"><span class="icon">📖</span><span class="label">Fact Files</span></a></li>
      <li><a href="livesky.html"><span class="icon">🔭</span><span class="label">Live Sky</span></a></li>
      <li><a href="events.html" class="active"><span class="icon">📅</span><span class="label">Events</span></a></li>
      <li><a href="space-news.html">🛰️ <span class="label">Space News</span></a></li>
      <li><a href="about.html"><span class="icon">ℹ️</span><span class="label">About</span></a></li>
    </ul>
  </aside>

  <!-- main content (style.css uses .content) -->
  <main class="content" id="mainContent">
    <h1>📅 Cosmic Events Calendar</h1>
    <p class="card">Monthly grid of moon phases, meteor showers, eclipses and planetary oppositions. Click a day for details.</p>

    <div class="calendar-container card">
      <div class="calendar-header">
        <div>
          <button id="prevMonth" class="btn">‹ Prev</button>
          <button id="nextMonth" class="btn">Next ›</button>
        </div>
        <h2 id="monthYear">Loading…</h2>
        <div></div>
      </div>

      <div class="weekday-row" id="weekdayRow"></div>
      <div class="calendar-grid" id="calendarGrid" aria-live="polite"></div>
    </div>
  </main>

  <script>
  /******************************************************************
   * Starfield — simple twinkling stars to match global style.css
   ******************************************************************/
  (function makeStarfield() {
    const container = document.getElementById('starfield');
    if (!container) return;
    const count = Math.min(Math.max(window.innerWidth * window.innerHeight / 60000, 60), 420) | 0;
    for (let i = 0; i < count; i++) {
      const s = document.createElement('div');
      s.className = 'star';
      const size = (Math.random() * 2.5) + 0.6;
      s.style.width = s.style.height = `${size}px`;
      s.style.left = `${Math.random() * 100}%`;
      s.style.top = `${Math.random() * 100}%`;
      s.style.opacity = Math.random() * 0.9;
      const dur = (Math.random() * 3.8) + 1.5;
      s.style.animation = `twinkle ${dur}s linear ${Math.random() * 3}s infinite`;
      container.appendChild(s);
    }
  })();

  /******************************************************************
   * Sidebar toggle — matches your style.css expectations
   * - toggles .sidebar.closed
   * - toggles .content.shifted so main margin-left adjusts
   ******************************************************************/
  const toggleBtn = document.getElementById('toggleBtn');
  const sidebar = document.getElementById('sidebar');
  const content = document.getElementById('mainContent');

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.toggle('closed');
    content.classList.toggle('shifted');
  });

  // Close sidebar by default on small screens
  if (window.innerWidth <= 820) {
    sidebar.classList.add('closed');
    content.classList.add('shifted');
  }

  /******************************************************************
   * Events generator (merged from your events.js)
   * Produces moonPhases, meteorShowers, eclipses, planetaryEvents
   ******************************************************************/
  const events = (() => {
    const START_YEAR = 2015;
    const END_YEAR = 2035;
    const MS_PER_DAY = 86400000;
    const SYNODIC_MONTH_DAYS = 29.530588853;
    const SYNODIC_MS = SYNODIC_MONTH_DAYS * MS_PER_DAY;
    const EPOCH_NEWMOON = Date.UTC(2000, 0, 6, 18, 14, 0);

    function isoDate(d) {
      const y = d.getUTCFullYear();
      const m = String(d.getUTCMonth() + 1).padStart(2, "0");
      const day = String(d.getUTCDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function generateMoonPhases(startDate, endDate) {
      const phases = [];
      const firstN = Math.floor((startDate.getTime() - EPOCH_NEWMOON) / SYNODIC_MS) - 1;
      const lastN = Math.ceil((endDate.getTime() - EPOCH_NEWMOON) / SYNODIC_MS) + 1;
      const phaseOffsets = [
        { name: "🌑 New Moon", frac: 0.0 },
        { name: "🌓 First Quarter", frac: 0.25 },
        { name: "🌕 Full Moon", frac: 0.5 },
        { name: "🌗 Last Quarter", frac: 0.75 }
      ];
      for (let n = firstN; n <= lastN; n++) {
        const newMoonTime = EPOCH_NEWMOON + n * SYNODIC_MS;
        for (const p of phaseOffsets) {
          const t = new Date(newMoonTime + p.frac * SYNODIC_MS);
          if (t >= startDate && t <= endDate) {
            phases.push({
              date: isoDate(t),
              utc: t.toISOString(),
              phase: p.name
            });
          }
        }
      }
      phases.sort((a, b) => (a.utc < b.utc ? -1 : 1));
      return phases;
    }

    const METEOR_SHOWER_TEMPLATES = [
      { name: "🌠 Quadrantids", monthDay: "01-04" },
      { name: "🌠 Lyrids", monthDay: "04-22" },
      { name: "🌠 Eta Aquariids", monthDay: "05-05" },
      { name: "🌠 Perseids", monthDay: "08-12" },
      { name: "🌠 Orionids", monthDay: "10-21" },
      { name: "🌠 Leonids", monthDay: "11-17" },
      { name: "🌠 Geminids", monthDay: "12-14" },
      { name: "🌠 Ursids", monthDay: "12-22" }
    ];
    function generateMeteorShowers(startYear, endYear) {
      const list = [];
      for (let y = startYear; y <= endYear; y++) {
        for (const t of METEOR_SHOWER_TEMPLATES) {
          const iso = `${y}-${t.monthDay}T00:00:00Z`;
          list.push({
            name: t.name,
            peak: iso.split('T')[0],
            peakUTC: iso
          });
        }
      }
      return list;
    }

    // small sample eclipse & planetary data (keeps file size reasonable)
    const eclipses = [
      { dateUTC: "2024-04-08T18:18:29Z", type: "🌑 Total Solar Eclipse" },
      { dateUTC: "2024-10-02T18:46:13Z", type: "🌑 Annular Solar Eclipse" },
      { dateUTC: "2025-03-14T06:59:56Z", type: "🌕 Total Lunar Eclipse" }
    ];

    const planetaryEvents = [
      { dateUTC: "2025-01-16T00:00:00Z", event: "🪐 Jupiter Opposition" },
      { dateUTC: "2025-02-28T00:00:00Z", event: "🪐 Saturn Opposition" },
      { dateUTC: "2025-12-18T00:00:00Z", event: "🪐 Mars Opposition" }
    ];

    const startDate = new Date(Date.UTC(START_YEAR, 0, 1));
    const endDate = new Date(Date.UTC(END_YEAR, 11, 31));
    const moonPhases = generateMoonPhases(startDate, endDate);
    const meteorShowers = generateMeteorShowers(START_YEAR, END_YEAR);

    return { moonPhases, meteorShowers, eclipses, planetaryEvents };
  })();

  /******************************************************************
   * Calendar rendering (monthly grid)
   ******************************************************************/
  const calendarGrid = document.getElementById('calendarGrid');
  const weekdayRow = document.getElementById('weekdayRow');
  const monthYear = document.getElementById('monthYear');
  const prevMonthBtn = document.getElementById('prevMonth');
  const nextMonthBtn = document.getElementById('nextMonth');
  let current = new Date();

  function drawWeekdays() {
    const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    weekdayRow.innerHTML = '';
    weekdays.forEach(w => {
      const el = document.createElement('div');
      el.className = 'weekday';
      el.textContent = w;
      weekdayRow.appendChild(el);
    });
  }

  function renderCalendar(date) {
    calendarGrid.innerHTML = '';
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    const monthNames = [
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    ];
    monthYear.textContent = `${monthNames[month]} ${year}`;

    // leading empty cells
    for (let i = 0; i < firstDay.getDay(); i++) {
      const c = document.createElement('div');
      c.className = 'empty';
      calendarGrid.appendChild(c);
    }

    // days
    for (let d = 1; d <= lastDay.getDate(); d++) {
      const cell = document.createElement('div');
      cell.className = 'day';
      const dn = document.createElement('div');
      dn.className = 'day-number';
      dn.textContent = d;
      cell.appendChild(dn);

      const cellDate = new Date(Date.UTC(year, month, d));
      const iso = cellDate.toISOString().split('T')[0];

      // collect events for this day (safe checks)
      const dayEvents = [
        ...events.moonPhases.filter(e => e.date === iso),
        ...events.meteorShowers.filter(e => e.peak === iso),
        ...events.eclipses.filter(e => e.dateUTC && e.dateUTC.startsWith(iso)),
        ...events.planetaryEvents.filter(e => e.dateUTC && e.dateUTC.startsWith(iso))
      ];

      if (dayEvents.length) {
        const ul = document.createElement('ul');
        dayEvents.forEach(ev => {
          const li = document.createElement('li');
          const text = ev.phase || ev.name || ev.type || ev.event || ev.title || '';
          li.innerHTML = `<span class="event-badge">${text}</span>`;
          ul.appendChild(li);
        });
        cell.appendChild(ul);
        cell.classList.add('has-event');
      }

      // optional: click to toggle details (simple)
      cell.addEventListener('click', () => {
        const wasOpen = cell.classList.toggle('open');
        if (wasOpen) cell.style.boxShadow = '0 10px 30px rgba(79,70,229,0.12)';
        else cell.style.boxShadow = '';
      });

      calendarGrid.appendChild(cell);
    }
  }

  // navigation
  prevMonthBtn.addEventListener('click', () => {
    current.setMonth(current.getMonth() - 1);
    renderCalendar(current);
  });
  nextMonthBtn.addEventListener('click', () => {
    current.setMonth(current.getMonth() + 1);
    renderCalendar(current);
  });

  // initialise
  drawWeekdays();
  renderCalendar(current);
  </script>
</body>
</html>
